var urlTop=window.route.indexOf("admin")>-1?"/admin/users/search":"/userlist",urlSaveData=window.route.indexOf("admin")>-1?"/admin/userlist/savedata":"/userlist/savedata",initTiny=function(){"use strict";window.tinymce.init({theme_advanced_font_sizes:"10px,12px,13px,14px,16px,18px,20px",fontsize_formats:"10px 11px 12px 13px 14px 16px 18px 20px",selector:"textarea.editit",language:"de",auto_focus:"post_text",menu:{edit:{title:"Edit",items:"undo redo | cut copy paste pastetext | selectall"},insert:{title:"Insert",items:"link media | template hr"},table:{title:"Table",items:"inserttable tableprops deletetable | cell row column"},tools:{title:"Tools",items:"spellchecker code"}},plugins:"autoresize emoticons lists table textcolor",toolbar:"insertfile undo redo | fontselect |  fontsizeselect | styleselect | forecolor backcolor | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | l ink image | print preview media fullpage | emoticons",content_css:window.urlAssets+"/css/tinymce.css"})},searchSortPaginate=function(a,b,c,d,e,f,g){"use strict";var h=g,i=null!==f?f.split("|")[0]:"";$.ajax({type:"POST",url:a,data:{search_field:b,sort_field:d,order_by:e,family:i,clan:c,user_id:$("#user_id").val()},success:function(a){h(a)}})},fillUserTable=function(a){"use strict";{var b,c="",d="#table-body",e={day:"numeric",month:"numeric",year:"numeric"};$("#users").outerWidth()}return $(d).html(""),void 0===a||0===a.length?($(d).html("Keine Daten"),$("#records_no").html(a.length),!1):($("#records_no").html(a.length),$.each(a,function(a,d){var f=void 0===d.user_address||""===d.user_address?" - ":d.user_address,g=void 0===d.user_zip||""===d.user_zip?" - ":d.user_zip,h=void 0===d.user_city||""===d.user_city?" - ":d.user_city,i=void 0===d.country.country||""===d.country.country?" - ":d.country.country,j="0"===d.user_new?"registriert":"neu",k=void 0===window.langUser.fonlabel[d.user_fon1_label]||""===window.langUser.fonlabel[d.user_fon1_label]?" - ":window.langUser.fonlabel[d.user_fon1_label];c+='<tr class="tr-body"><td><a href="https://palazzin.ch/user/profile/'+d.id+'"><span class="glyphicon glyphicon-th-list" aria-hidden="true"></span></a></td>',window.location.href.indexOf("admin/users")>-1&&(c+='<td><a href="'+window.urlTo+"/admin/users/edit/"+d.id+'"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a></td>',c+='<td><a id="destroyUser_'+d.id+"_"+d.user_first_name+"_"+d.user_name+'" href="#"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></a></td><td>'+j+"</td>"),c+="<td>"+d.clans.clan_description+"/<br> ",null!==d.families&&(c+=d.families.family_description),c+=' </td><td class="firstname_1">'+d.user_first_name+'</td><td class="name_1">'+d.user_name+"</td><td>"+d.user_login_name+'</td><td><table class="table mailz"><tbody><tr><td><a class="mail_one" href="mailto:'+d.email+'">'+d.email+"</a></td></tr>",""!==d.user_email2&&null!==d.user_email2&&(c+='<tr><td><a href="mailto:'+d.user_email2+'">'+d.user_email2+"</a></td></tr>"),c+="</tbody></table></td>",c+=""!==d.user_www&&null!==d.user_www&&""!==d.user_www_label&&null!==d.user_www_label?'<td><a href="https://'+d.user_www+'" target="_blank">'+d.user_www_label+"</a></td>":'<td><a href="#"></a></td>',c+="<td>"+f+"</td><td>"+g+"</td><td>"+h+"</td><td>"+i+'</td><td><table class="table fonz"><tbody>',c+="<tr><td>"+k+"<br>"+d.user_fon1+"</td></tr>",""!==d.user_fon2&&null!==d.user_fon2&&(c+="<tr><td>"+window.langUser.fonlabel[d.user_fon2_label]+"<br>"+d.user_fon2+"</td></tr>"),""!==d.user_fon3&&null!==d.user_fon3&&(c+="<tr><td>"+window.langUser.fonlabel[d.user_fon3_label]+"<br>"+d.user_fon3+"</td></tr>"),c+="</tbody></table></td>",b=new Date(1e3*d.user_birthday),c+='<td class="date-header">'+b.toLocaleDateString(window.locale,e)+'</td><td class="date-header">'+d.user_last_login+'</td><td><table class="table"><tbody>',void 0!==d.roles&&$.each(d.roles,function(a,b){c+="<tr><td>"+window.langRole[b.role_code]+"</td></tr>"}),c+="</tbody></table></td></tr>"}),$(d).html(c),jQuery("#users").TableWizard({tableWidth:$(".table-head>tr").outerWidth(),subTableWidth:$(".mailz>tbody>tr").innerWidth(),isAjax:!0}),void window.putUserSearchResultsToSession(urlSaveData,$("#printer").html()))};$(document).ready(function(){"use strict";var a=new Date,b=$("#year"),c=$("#month");window.yl=window.createYearList(),window.ml=window.createMonthList(),window.fillSelect(c,window.ml,!1),window.fillSelect(b,window.yl,!0),b.val(a.getFullYear()),c.val(a.getMonth()),window.putUserSearchResultsToSession(urlSaveData,$("#printer").html()),$("#newsMessage").hide()}),jQuery(document).on("click","#sendMessage",function(a){a.preventDefault(),$("#newsMessage").slideToggle("slow"),$("#message_text").val(""),initTiny(),null!==window.tinyMCE.activeEditor&&window.tinyMCE.activeEditor.setContent("")}),jQuery(document).on("click","#cancel_new_message",function(a){a.preventDefault(),$("#newsMessage").slideUp("slow")}),jQuery(document).on("click","#send_new_message",function(a){a.preventDefault();var b=$(".mail_one"),c=[];return $.each(b,function(a,b){c.push(b.innerText)}),tinyMCE.activeEditor.getContent().length<4?($("#four_char").modal({backdrop:"static",keyboard:!1}),!1):void $.ajax({type:"GET",url:"userlist/sendmail",data:{message_text:tinyMCE.activeEditor.getContent(),mails:c},success:function(a){console.log(a),$("#newsMessage").slideUp("slow"),$("#msent").text(a),$("#message_sent").modal({backdrop:"static",keyboard:!1})}})});var timer,chk_me=function(a){clearTimeout(timer),timer=setTimeout(function(){searchIt(a)},500)},searchIt=function(a){var b,c,d;return $("#search_user").val().length<3&&0===$("#clan_search").val().length&&0===$("#family_search").val().length||"sendMessage"===this.id?!1:(a.target.hasOwnProperty("config")?(b=a.target.config.sortList[0],c=$(window.cols[b[0]]).attr("id"),d=1===b[1]?"ASC":"DESC"):(c="user_name",d="ASC"),null!==$("#family_search").val()&&$("#clan_search").val(""),void searchSortPaginate(urlTop,$("#search_user").val(),$("#clan_search").val(),c,d,$("#family_search").val(),fillUserTable))};$(document).keyup("#search_user",function(a){"use strict";chk_me(a)}),$(document).on("change","#clan_search",function(a){"use strict";var b=window.families,c=[];$.each(b,function(a,b){""!==a&&c.push({val:a,text:b})}),console.log(c),$("#family_search").find("option").remove().end(),$.each(c,function(a,b){b.val.split("|")[1]===$("#clan_search").val()&&$("#family_search").append('<option value="'+b.val+'">'+b.text+"</option>").val("")}),chk_me(a)}),$(document).on("change","#family_search",function(a){"use strict";console.log(this.id),chk_me(a)}),$(document).on("submit","form",function(a){"use strict";return a.preventDefault(),!1}),$("#users").bind("sortStart",function(){"use strict";$("#table-body").html("")}),$("#users").bind("sortEnd",function(a){"use strict";var b=a.target.config.sortList[0],c=$(window.cols[b[0]]).attr("id"),d=1===b[1]?"ASC":"DESC",e=""===$("#search_user").val()?$("#clan_search").val():$("#search_user").val(),f=""!==$("#clan_search").val()?$("#clan_search").val():null;$("#table-body").html(""),window.searchSortPaginate(urlTop,e,f,c,d,null,window.fillUserTable)});