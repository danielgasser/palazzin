var postLoadTimeOut=6e5,comment_viewed=!1,counter=0,warningTimer,loadPosts=function(){"use strict";$.ajax({type:"GET",contentType:"application/x-www-form-urlencoded;charset=utf-8",url:"news_reloaded",success:function(a){if("string"==typeof a&&a.indexOf("<!DOCTYPE")>-1)return!1;var b,c="",d=a[0],e=a.auth;$.each(d,function(a,d){b=$("#editPost_"+d.id).length>0?'<span id="editPost_'+d.id+'" class="glyphicon glyphicon-pencil edit"></span><span id="deleteComment_'+d.id+'" class="glyphicon glyphicon-remove edit"></span>':"",c+='<div class="row"><div class="col-sm-12 col-md-12 posts"><h4>'+window.lang.post_from+' <a href="'+window.urlTo+"user/profile/"+d.user_id+'">'+d.user_login_name+"</a></h4><p>"+d.created_at+" "+b+'</p></div></div><div class="row postrow"><div class="col-sm-12 col-md-12 posts">'+d.post_text+'</div><div class="col-sm-12 col-md-12 comments">',d.comments.length>0&&(c+='<h4 class="comments-titles">'+window.lang.comments_title+"</h4>"),c+='<ul id="comments_'+d.id+'">',$.each(d.comments,function(a,b){c+='<li id="commentId_'+b.id+'">'+window.lang.comment_from+' <a href="'+window.urlTo+"user/profile/"+b.user_id+'">'+b.user_login_name+"</a> "+window.lang.comment_at+" "+b.created_at,e===b.user_id&&"1"===b.editable&&(c+='<span id="editComment_'+b.id+'" class="glyphicon glyphicon-pencil edit"></span><span id="deleteComment_'+b.id+'" class="glyphicon glyphicon-remove edit"></span>'),c+='<br>"'+b.comment_text+'"</li>'}),c+='</ul></div><div class="col-sm-12 col-md-12 comments"><a href="#" id="addComment_'+d.id+'">'+window.lang.add_comment+'</a></div><div class="col-sm-12 col-md-4 comments" id="comment-add-area_'+d.id+'"></div><div class="col-sm-12 col-md-2 comments" id="comment-add_'+d.id+'"></div><div class="col-sm-12 col-md-6 comments"></div></div>'}),$("#newsticker").html(c)}}),window.setTimeout(loadPosts,postLoadTimeOut)},appendComment=function(a,b,c){"use strict";a.comments.length>1&&$(c+b).html(""),$.each(a.comments,function(c,d){console.log(d);var e=a.auth===d.user_id&&d.editable?'<span id="editComment_'+d.id+'" class="glyphicon glyphicon-pencil edit"></span><span id="deleteComment_'+d.id+'" class="glyphicon glyphicon-remove edit"></span>':"";$("#commentId_"+d.id).length>0&&$("#commentId_"+d.id).remove(),$("#comments_"+b).append('<li id="commentId_'+d.id+'">'+e+window.lang.comment_from+' <a href="'+window.urlTo+"/user/profile/"+d.user_id+'">'+d.user_login_name+"</a> "+window.lang.comment_at+" "+d.created_at+'<br>"'+d.comment_text+'"</li>')}),$('[id^="closeComment_"]').trigger("click")},initTiny=function(){"use strict";window.tinymce.init({theme_advanced_font_sizes:"10px,12px,13px,14px,16px,18px,20px",fontsize_formats:"10px 11px 12px 13px 14px 16px 18px 20px",selector:"textarea.editit",language:"de",auto_focus:"post_text",menu:{edit:{title:"Edit",items:"undo redo | cut copy paste pastetext | selectall"},insert:{title:"Insert",items:"link media | template hr"},table:{title:"Table",items:"inserttable tableprops deletetable | cell row column"},tools:{title:"Tools",items:"spellchecker code"}},plugins:"autoresize emoticons lists table textcolor",toolbar:"insertfile undo redo | fontselect |  fontsizeselect | styleselect | forecolor backcolor | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | l ink image | print preview media fullpage | emoticons",content_css:window.urlAssets+"/css/tinymce.css"})},toggleWarning=function(){"use strict";var a=$("#counter"),b=window.parseInt(a.val(),10);return $(".ach").toggle(),b+=1,a.val(b),b>6?(window.clearTimeout(warningTimer),void $(".ach").show()):void(warningTimer=window.setTimeout(toggleWarning,1e3))};jQuery(document).ready(function(){"use strict";toggleWarning(),window.setTimeout(loadPosts(),postLoadTimeOut),window.setTimeout(function(){$("#warnings").slideUp(1e3)},postLoadTimeOut/10),window.localStorage.hasOwnProperty("comment_viewed")||""!==window.new_comment&&window.new_comment_user_id!==window.autid&&($("#new_comment_available").modal({backdrop:"static",keyboard:!1}),$("#commentId_"+window.new_comment).addClass("new_comment_available")),jQuery(document).on("click","#close_warning",function(){$(this).children("span").hasClass("glyphicon-chevron-up")?($(this).children("span").removeClass("glyphicon-chevron-up"),$(this).children("span").addClass("glyphicon-chevron-down")):($(this).children("span").removeClass("glyphicon-chevron-down"),$(this).children("span").addClass("glyphicon-chevron-up")),$("#warnings").slideToggle()}),jQuery(document).on("click","#cancel_new_comment",function(){window.localStorage.setItem("comment_viewed","true"),window.scrollIt("body, html, #newsticker",$("#commentId_"+window.new_comment).offset().top+$("#commentId_"+window.new_comment).height(),"slow"),window.setTimeout(function(){$("#commentId_"+window.new_comment).removeClass("new_comment_available")},1500)}),jQuery(document).on("click","#add_post",function(a){a.preventDefault(),$("#newstickerNewPost").slideToggle("slow"),window.scrollIt("#newsticker",0,"slow"),$("#post_text").val(""),initTiny(),null!==window.tinyMCE.activeEditor&&window.tinyMCE.activeEditor.setContent("")}),jQuery(document).on("click","#cancel_new_post",function(a){a.preventDefault(),$("#newstickerNewPost").slideUp("slow"),$('[id^="closeComment_"]').trigger("click"),$("#post_text").val("")}),jQuery(document).on("click",'[id^="editPost_"]',function(a){a.preventDefault(),initTiny(),$.ajax({type:"GET",url:"news/getone",data:{id:$(this).attr("id").split("_")[1]},success:function(a){$("#newstickerNewPost").slideDown("slow").promise().always(function(){window.tinyMCE.get("post_text").setContent(a.post_text)}),$("#post_text").val(a.post_text),$("#id").val(a.id)}})}),jQuery(document).on("click",'[id^="moreComments_"]',function(){var a=$(this).attr("id").split("_")[1],b=$(this).attr("data_no");return"true"===$(this).attr("data_less")?($.each($('[id^="comments_"]>li'),function(a,b){a>2&&$(b).remove()}),$(this).attr("data_less",!1).text(window.lang.show_+" "+(b-3)+" "+window.lang.show_more_comments),!1):($.ajax({type:"GET",url:"news/getcomments",data:{id:a},success:function(b){appendComment(b,a,"#comments_")}}),void $(this).attr("data_less",!0).text(window.lang.show_less_comments))}),jQuery(document).on("click",'[id^="deletePost_"]',function(){var a=$(this).attr("id").split("_")[1];$.ajax({type:"POST",url:"news/delete",data:{id:a},success:function(){$("#post_"+a).remove(),$('[id^="closeComment_"]').trigger("click")}})}),jQuery(document).on("click",'[id^="deleteComment_"]',function(){var a=$(this).attr("id").split("_")[1];$.ajax({type:"GET",url:"news/deletecomment",data:{id:a},success:function(){$("#commentId_"+a).remove(),$('[id^="closeComment_"]').trigger("click")}})}),jQuery(document).on("click",'[id^="closeComment_"]',function(){var a=$(this).attr("id").split("_")[1];$("#comment_text_"+a+", #comment_id_"+a+", #saveComment_"+a+", #closeComment_"+a).remove()}),jQuery(document).on("click",'[id^="addComment_"]',function(){var a=$(this).attr("id").split("_")[1];$('[id^="comment_text_"], [id^="comment_id_"], [id^="saveComment_"], [id^="closeComment_"]').remove(),$("#comment-add-area_"+a).html('<textarea class="form-control" id="comment_text_'+a+'" name="comment_text" /></textarea>'),$("#comment-add_"+a).html('<span id="saveComment_'+a+'" class="glyphicon glyphicon-ok edit"></span><br><span id="closeComment_'+a+'" class="glyphicon glyphicon-remove edit"></span>'),$("#comment_text_"+a).focus(),window.scrollIt("body, html",$("#addComment_"+a).offset().top+$("#addComment_"+a).height(),"slow")}),jQuery(document).on("click",'[id^="saveComment_"]',function(){var a=$(this).attr("id").split("_")[1];$.ajax({type:"POST",url:"news/addcomment",data:{post_id:a,comment_text:$("#comment_text_"+a).val(),comment_id:$("#comment_id_"+a).val()},success:function(b){return b.hasOwnProperty("error")?($("#message").html(b.error),$("#comments_too_much").modal({backdrop:"static",keyboard:!1}),$('[id^="closeComment_"]').trigger("click"),!1):void appendComment(b,a,"#comments_")}})}),jQuery(document).on("click","#save_new_post",function(a){a.preventDefault(),$("#newstickerNewPost").slideUp("slow"),$("#post_"+$("#id").val()).remove(),$.ajax({type:"POST",url:"news",data:{post_text:window.tinyMCE.activeEditor.getContent(),id:$("#id").val()},success:function(a){if(a[0].indexOf("error")>-1)return $("#message").html(a[1]),$("#comments_too_much").modal({backdrop:"static",keyboard:!1}),!1;var b,c=a[0][0],d=a.auth;b=d===c.uid&&c.editable?'<span id="editPost_'+c.id+'" class="glyphicon glyphicon-pencil edit"></span><span id="deleteComment_'+c.id+'" class="glyphicon glyphicon-remove edit"></span>':"",$("#newsticker").prepend('<div id="post_'+c.id+'"><div class="row"><div class="col-sm-12 col-md-12 posts"><h4>'+window.lang.post_from+' <a href="'+window.urlTo+"user/profile/"+c.user_id+'">'+c.user_login_name+"</a></h4><p>"+c.created_at+" "+b+'</p></div></div><div class="row postrow"><div class="col-sm-12 col-md-12 posts">'+c.post_text+'</div><div class="col-sm-12 col-md-12 comments"><ul id="comments_'+c.id+'"></ul></div><div class="col-sm-12 col-md-12 comments"><a href="#" id="addComment_'+c.id+'">'+window.lang.add_comment+'</a></div><div class="col-sm-12 col-md-4 comments" id="comment-add-area_'+c.id+'"></div><div class="col-sm-12 col-md-2 comments" id="comment-add_'+c.id+'"></div><div class="col-sm-12 col-md-6 comments"></div></div>')}})}),jQuery(document).on("click",'[id^="editComment_"]',function(){var a=$(this).attr("id").split("_")[1];$.ajax({type:"GET",url:"news/getcomment",data:{id:a},success:function(a){$("#addComment_"+a.post_id).trigger("click"),$("#comment_text_"+a.post_id).val(a.comment_text),$("#comment-add-area_"+a.post_id).append('<input id="comment_id_'+a.post_id+'" name="comment_id" type="hidden" value="'+a.id+'">')}})})});