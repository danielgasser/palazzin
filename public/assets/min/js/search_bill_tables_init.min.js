var fillBillTable=function(a){"use strict";var b="",c="",d="",e=0;return $('[id^="heading_"]').html(""),$('[id^="keeperData_"]').html(""),void 0===a||0===a.length?($(".white-row").html(""),$('[id^="heading_"]').first().html("<h3>"+window.langError+"</h3>"),!1):(d="admin/bills"===window.route?window.billPaid:"",$.each(a,function(a,e){var f;"1"===e.bill_due?(f=window.langDialog.n,d='<input class="form-control" id="bill_paid_'+a+'" data_id="'+e.id+'" name="bill_paid" type="date"><button class="btn btn-default" id="savePaid_'+e.id+"_"+a+'">'+window.langDialog.save+"</button>"):f=window.langDialog.y,b+='<thead id="heading_'+e.id+'">',b+='<tr class="keeperDataHead"><th style="height: 62px" class="white-row" colspan="5">'+window.langBill.bill_no.replace(/\<br\>/," - ")+" "+e.bill_no+"</th></tr>",b+='<tr><th colspan="4">',"admin/bills"===window.route&&(b+=window.langProfile.address),b+="</th><th>"+window.langBill.date+"</th></tr>",b+="<tr>",b+="admin/bills"===window.route?'<th colspan="2" class="address">'+e.user.user_first_name+" "+e.user.user_name+"<br>"+e.user.user_address+"<br>"+e.user.user_zip+" "+e.user.user_city+"<br>"+e.user.country+'</th><th colspan="2" class="address"><a href="mailto:'+e.user.email+'">'+e.user.email+"</a><br>"+e.user.user_fon1_label+" "+e.user.user_fon1+"<br>"+e.user.user_fon2_label+" "+e.user.user_fon2+"<br>"+e.user.user_fon3_label+" "+e.user.user_fon3+"<br></th>":'<th colspan="4" class="address"></th>',b+='<th class="white-row address" colspan="1">'+e.bill_bill_date_show+"</th></tr>",b+='<tr class="keeperDataHead"><th>'+window.langRes.arrival+"</th><th>"+window.langRes.depart+"</th><th>"+window.langRes.nights+"</th><th>"+window.langRes.guests.title+"</th><th>PDF</th></tr></thead>",$("#allReservations").append(b),b="",c+='<tbody id="keeperData_'+e.id+'">',c+="<tr><td>"+e.reservation.reservation_started_at_show+"</td><td>"+e.reservation.reservation_ended_at_show+"</td><td>"+e.reservation.reservation_nights+'</td><td><table class="table" id="allGuests_27"><thead>',c+="<tr><th>"+window.langRes.arrival+"</th><th>"+window.langRes.depart+"</th><th>"+window.langRes.guests.number+"</th><th>"+window.langRes.guests.role+"</th><th>"+window.langRes.guests.tax_night+"</th><th>"+window.langRes.nights+"</th><th>"+window.langRes.guests.total+"</th></tr></thead>",c+="<tbody>",$.each(e.reservation.guests,function(a,b){c+="<tr><td>"+b.guest_started_at_show+"</td><td>"+b.guest_ended_at_show+"</td><td>"+b.guest_number+"</td><td>"+b.role_code+"</td><td>"+b.role_tax_night+"</td><td>"+b.guest_night+"</td><td>"+b.guestSum.toFixed(2)+"</td></tr>"}),c+='</tbody></table></td><td><a target="_blank" href="'+window.urlTo+"/"+e.bill_path+'">'+e.bill_no+'.pdf</a></td></tr><tr><td colspan="5"><table id="bill_totals" style="width: 100%;"><thead><tr><th class="white-row">'+window.langBill.currency+'</th><th class="white-row">'+window.langBill.sub_total_bill+'</th><th class="white-row">'+window.langBill.taxes+'</th><th class="white-row">'+window.langBill.total_bill+'</th><th class="white-row">'+window.langBill.paid+'</th><th colspan="2" class="white-row">'+window.langBill.paid_at+'</th></tr></thead><tbody><tr><th class="white-row">'+e.bill_currency+'</th><th class="white-row">'+e.bill_sub_total+'</th><th class="white-row">'+e.bill_tax+'%</th><th class="white-row">'+e.bill_total+'</th><th class="white-row" id="paid_or_not_'+a+'">'+window.pay_yesno[e.bill_due]+"</th>",c+="0"===e.bill_due?'<th colspan="2" class="white-row" id="when_paid_'+a+'">'+e.bill_paid+'<br><button class="btn btn-default" id="undoSavePaid_'+e.id+"_"+a+'">'+window.langDialog.reset+"</button>":'<th colspan="2" class="white-row" id="when_paid_'+a+'">'+d+"</th>",c+='</tr><tr><th colspan="6" style="border-top: 4px double #000000;"></th></tr></tbody></table></td></tr></tbody>',$("#allReservations").append(c),$("#bill_paid").attr("data-id",e.id),c=""}),e=a[a.length-1].subtotals,$("#bill_currency").html(a[a.length-1].bill_currency),$("#bill_subtotals").html(e),$("#bill_taxes").html(a[a.length-1].bill_tax+"%"),$("#bill_totals").html(a[a.length-1].totals),void window.adaptEmptyInputs())},searchSortPaginate=function(a,b,c,d,e,f,g,h){"use strict";var i=g,j=void 0!==h||""===h?h:"";$.ajax({type:"GET",url:a,data:{search_field:b,sort_field:d,order_by:e,page:f,start:c,paid:$("#search_bill_paid").val(),monthyear:j},success:function(a){i(a)}})},searchBillNo=function(a,b){"use strict";var c=b;$.ajax({type:"GET",url:"/bill/search_billno",data:{bill_no:a},success:function(a){c(a)}})};$(document).ready(function(){"use strict";var a=(new Date,$("#year")),b=$("#month");window.yl=window.createYearList(),window.ml=window.createMonthList(),window.fillSelect(b,window.ml,!1,"",!0),window.fillSelect(a,window.yl,!0,"",!0),a.val("x"),b.val("x"),$("#billNo").val("No-"),"user/bills"!==window.route&&$("#searchIt").chosen({no_results_text:"Keine Eintr√§ge gefunden",enable_split_word_search:!0,search_contains:!0})}),$(document).on("click","#resetUserDropDown",function(a){"use strict";$("#searchIt").val("").trigger("chosen:updated").trigger("change")}),$(document).on("click","#resetKeeper",function(a){"use strict";$("#searchIt").val(""),$("#month").val(""),$("#year").val(""),window.location.reload()}),$(document).on("keyup","#billNo",function(a){"use strict";a.preventDefault();var b=$(this).val(),c="No-";return b.length<3?!1:(-1===b.indexOf(c)&&($(this).val(c+b),b=c+b),void searchBillNo(b,fillBillTable))}),$("#searchKeeper").on("click",function(){"use strict";var a,b,c=$("#searchIt")[0].selectedOptions[0].value,d="x"!==$("#year").val()?$("#year").val():null,e="x"!==$("#month").val()?$("#month").val():null;null===d&&(b="-"+window.smallerThenTen(parseInt(e,10)+1)+"-"),null===e&&(b=window.smallerThenTen(parseInt(d,10))+"-"),null!==d&&null!==e&&(a=d+"-"+window.smallerThenTen(parseInt(e,10)+1)+"-01"),null===d&&null===e&&(b=""),searchSortPaginate("/bill/search",c,a,"bill_bill_date","DESC",$("#search_bill_paid").val(),fillBillTable,b)}),$(window.a).tablesorter(),$(window.a).bind("sortStart",function(a){"use strict";$("#keeperData").html("")}),$(window.a).bind("sortEnd",function(a){"use strict";var b=a.target.config.sortList[0],c=$(window.cols[b[0]]).attr("id"),d=1===b[1]?"ASC":"DESC";window.searchSortPaginate("/bill/search/",$("#searchIt")[0].selectedOptions[0].value,c,d,null,window.fillBillTable)});