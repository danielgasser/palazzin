var V3Reservation={allPeriods:{},periodID:null,fromPeriod:!1,globalDateFormat:"dd.MM.yyyy",tmpDate:new Date,freeBeds:{},tooMuch:!1,periodEndDate:null,datePickerSettings:{},disabledDates:[],firstTimeChangeEndDate:0,langStrings:window.reservationStrings,giveFocus:function(a){return $("input:not([type=\"hidden\"]), select").removeClass("giveFocus"),void 0!==a&&void $(a).addClass("giveFocus")},noClick:function(a){a?($.each($("[id^=\"reservation_guest_ended_at_\"]"),function(a,b){$(b).addClass("noClick"),$("#reservation_guest_guests_"+a).addClass("noClick"),$("#reservation_guest_num_"+a).addClass("noClick"),$("#reservation_guest_started_at_"+a).addClass("noClick")}),$("#reservation_ended_at").addClass("noClick"),$("#show-all-free-beds").addClass("noClick")):($.each($("[id^=\"reservation_guest_ended_at_\"]"),function(a,b){$(b).removeClass("noClick"),$("#reservation_guest_guests_"+a).removeClass("noClick"),$("#reservation_guest_num_"+a).removeClass("noClick"),$("#reservation_guest_started_at_"+a).removeClass("noClick")}),$("#reservation_ended_at").removeClass("noClick"),$("#show-all-free-beds").removeClass("noClick")),""!==$("#reservation_started_at").val()&&($("#reservation_ended_at").removeClass("noClick"),$("#show-all-free-beds").removeClass("noClick"))},onHide:function(a){let b,c,d,e;if("reservation_started_at"===a.target.id){if(void 0===a.date)return V3Reservation.noClick(!0),!1;V3Reservation.noClick(!1),d=$("#reservation_ended_at").val().split("."),e={startDate:new Date(a.date.valueOf()),endDate:new Date(d[2],d[1]-1,d[0],0,0,0,0)},V3Reservation.giveFocus("#reservation_ended_at")}else if("reservation_ended_at"===a.target.id){if(void 0===a.date)return!1;if(c=$("#reservation_started_at").val().split("."),e={startDate:new Date(c[2],c[1]-1,c[0],0,0,0,0),endDate:new Date(a.date.valueOf())},void 0!==$(".range-end").attr("class")&&(b=$(".range-end").attr("class").split(" "),b[b.length-1]!==localStorage.getItem("startPID"))){let a=$.parseJSON(localStorage.getItem("period_"+localStorage.getItem("startPID").split("_")[1]));return V3Reservation.periodEndDate=new Date(a.period_end),$("#over_oeriod_date").html(V3Reservation.formatDate(V3Reservation.periodEndDate)),window.resEndPicker.datepicker("setDate",V3Reservation.periodEndDate),$("#over_period").show(),!1}1===$("[id^=\"guests_date_\"]").length&&($("#guests_date_0").show(),V3Reservation.giveFocus("#reservation_guest_started_at_0"))}else if(-1<a.target.id.indexOf("reservation_guest")){if(void 0===a.date)return!1;let b=$("#"+a.target.id).attr("id").split("_")[4];void 0===b&&(b=0),-1<a.target.id.indexOf("start")&&""===$("#reservation_started_at").val()&&(window.resStartPicker.datepicker("setDate",window.startGuestPicker[b].datepicker("getDate")),V3Reservation.giveFocus("#reservation_guest_ended_at_"+b)),-1<a.target.id.indexOf("end")&&""===$("#reservation_ended_at").val()&&window.resEndPicker.datepicker("setDate",window.endGuestPicker[b].datepicker("getDate")),V3Reservation.calcNights(window.startGuestPicker[b].datepicker("getDate"),window.endGuestPicker[b].datepicker("getDate"),"#number_nights_"+b),V3Reservation.calcAllPrices(),c=$("#reservation_started_at").val().split("."),e={startDate:window.startGuestPicker[b].datepicker("getDate"),endDate:window.endGuestPicker[b].datepicker("getDate")}}$("#reservation_guest_guests_0").attr("disabled",!1),$("#reservation_guest_num_0").attr("disabled",!1),V3Reservation.adaptChanged(e,window.endDate)},addBeforeShowDayEdit:function(a,b,c){let d,e=window.settings.setting_num_bed,f=a.getFullYear()+"_"+GlobalFunctions.smallerThenTen(a.getMonth())+"_"+GlobalFunctions.smallerThenTen(a.getDate()),g=parseInt(window.newAllGuestBeds["freeBeds_"+f+"uID"],10),h=V3Reservation.formatDate(a,!1,"_"),i=isNaN(parseInt(window.newAllGuestBeds["freeBeds_"+f],10))?0:parseInt(window.newAllGuestBeds["freeBeds_"+f],10),j=0,k=new Date,l=window.newUserRes.hasOwnProperty("user_Res_Dates_"+f)&&!c?" myRes":"",m=void 0===window.newAllGuestBeds["freeBeds_"+f]?"<span class=\"freeB\">"+e+"</span><span class=\"occB\">0</span>":"<span class=\"freeB\">"+(e-i)+"</span><span class=\"occB\">"+i+"</span>",n=void 0===window.datePickerPeriods[h]?"":window.datePickerPeriods[h].split("|"),o=$(".priority>li>."+n[0]+"-datepicker-content"),p=4===n.length?n[0]+"-datepicker-"+n[3]+" ":n[0]+"-datepicker-content ",q=!1,r=i<e;return k.setHours(0,0,0,0),q=c?!!(a.getTime()>=k.getTime())||!!(window.uID.clan_code!==n[0]&&a<=b&&a.getTime()>=k.getTime()):!!(a.getTime()>=k.getTime())||window.uID.clan_code===n[0]||!!(window.uID.clan_code!==n[0]&&a<=b&&a.getTime()>=k.getTime())||window.endDate===a||void 0===window.newAllGuestBeds["freeBeds_"+f+"uID"+window.autid],c?(j=window.newUserRes["user_Res_Dates_"+f],isNaN(j)&&(j=0),r=i-j<e):("WO"===n[0]?$(".priority>li>.GU-datepicker-content").html(window.allClans.GU).css({color:"#333"}):$(".priority>li>.WO-datepicker-content").html(window.allClans.WO).css({color:"#333"}),o.html(window.reservationStrings.prior+": "+n[1]).css({color:"#b7282e"})),r||(q=!1),d={enabled:q,tooltip:n[1],classes:p+"pID_"+n[2]+l,content:"<div class=\"datepicker-occupied-beds\">"+m+"</div><div class=\"datepicker-day-date\">"+a.getDate()+"</div>"},d},addBeforeShowDayNew:function(a,b,c){let d,e=window.settings.setting_num_bed,f=a.getFullYear()+"_"+GlobalFunctions.smallerThenTen(a.getMonth())+"_"+GlobalFunctions.smallerThenTen(a.getDate()),g=V3Reservation.formatDate(a,!1,"_"),h=isNaN(parseInt(window.newAllGuestBeds["freeBeds_"+f],10))?0:parseInt(window.newAllGuestBeds["freeBeds_"+f],10),i=0,j=new Date,k=new Date,l=new Date(a.getTime()),m=window.newUserRes.hasOwnProperty("user_Res_Dates_"+f)&&!c?" myRes":"",n=void 0===window.newAllGuestBeds["freeBeds_"+f]?"<span class=\"freeB\">"+e+"</span><span class=\"occB\">0</span>":"<span class=\"freeB\">"+(e-h)+"</span><span class=\"occB\">"+h+"</span>",o=void 0===window.datePickerPeriods[g]?"":window.datePickerPeriods[g].split("|"),p=$(".priority>li>."+o[0]+"-datepicker-content"),q=4===o.length?o[0]+"-datepicker-"+o[3]+" ":o[0]+"-datepicker-content ",r=!1,s=h<e;return j.setHours(0,0,0,0),k.setDate(j.getDate()+10),l.setDate(a.getDate()+10),a.getTime()>=j.getTime()&&void 0===window.newAllGuestBeds["freeBeds_"+f+"uID"+window.autid]&&(r=!0),window.uID.clan_code!==o[0]&&l>k&&(r=!1),c?(i=window.newUserRes["user_Res_Dates_"+f],isNaN(i)&&(i=0),s=h-i<e):("WO"===o[0]?$(".priority>li>.GU-datepicker-content").html(window.allClans.GU).css({color:"#333"}):$(".priority>li>.WO-datepicker-content").html(window.allClans.WO).css({color:"#333"}),p.html(window.reservationStrings.prior+": "+o[1]).css({color:"#b7282e"})),s||(r=!1),d={enabled:r,tooltip:o[1],classes:q+"pID_"+o[2]+m,content:"<div class=\"datepicker-occupied-beds\">"+n+"</div><div class=\"datepicker-day-date\">"+a.getDate()+"</div>"},d},initNew:function(a,b,c){V3Reservation.periodID=a,V3Reservation.fromPeriod=c;let d,e,f,g=$.parseJSON(localStorage.getItem("period_"+V3Reservation.periodID)),h=new Date,i=new Date;i.setDate(i.getDate()+10),i.setHours(0,0,0,0),h.setHours(0,0,0,0),null===g&&(V3Reservation.writeLocalStorage(window.periods),g=$.parseJSON(localStorage.getItem("period_"+V3Reservation.periodID))),$("#periodID").val(V3Reservation.periodID),b<h&&!V3Reservation.fromPeriod&&(b=h),e=$(".priority>li>."+g.clan_code+"-datepicker-content"),f=e.html();let j=g.period_end.replace(" ","T");if(V3Reservation.periodEndDate=new Date(j),j=window.settings.setting_calendar_start.replace(" ","T"),window.endDate=new Date(j),b.setHours(0,0,0,0),window.endDate.setHours(0,0,0,0),V3Reservation.fromPeriod&&(window.endDate=V3Reservation.periodEndDate),window.endDate.setFullYear(window.endDate.getFullYear()+parseInt(window.settings.setting_calendar_duration)),$("#hideAll").hide(),$("[id^=\"show_res\"]").show(),e.html(window.reservationStrings.prior+": "+f).css({color:"#b7282e !important"}),V3Reservation.datePickerSettings={format:"dd.mm.yyyy",weekStart:1,todayBtn:"linked",clearBtn:!0,language:"de",calendarWeeks:!0,autoclose:!0,todayHighlight:!0,startDate:V3Reservation.formatDate(h),endDate:V3Reservation.formatDate(window.endDate),defaultViewDate:{year:h.getFullYear(),month:h.getMonth(),day:h.getDate()},beforeShowDay:function(a){return V3Reservation.addBeforeShowDayNew(a,i,!1)},orientation:"bottom center"},$(".input-daterange").datepicker(V3Reservation.datePickerSettings).on("hide",function(a){let b,c=V3Reservation.formatDate(a.date,!1,"_");return c?void(b=window.datePickerPeriods[c].split("|"),$("#periodID").val(b[2]),V3Reservation.onHide(a)):(V3Reservation.giveFocus(),V3Reservation.noClick(!0),!1)}),window.resStartPicker=$(".input-daterange").find("#reservation_started_at"),window.resEndPicker=$(".input-daterange").find("#reservation_ended_at"),V3Reservation.fromPeriod){window.resStartPicker.datepicker("setDate",b);let a={startDate:b,endDate:new Date(V3Reservation.periodEndDate.getTime())};V3Reservation.adaptChanged(a,a.endDate),window.resEndPicker.datepicker("setDate",null),V3Reservation.noClick(!1)}d=$("#guestDates_0"),d.datepicker(V3Reservation.datePickerSettings),window.startGuestPicker[0]=d.find("#reservation_guest_started_at_0"),window.endGuestPicker[0]=d.find("#reservation_guest_ended_at_0"),V3Reservation.getFreeBeds(window.resStartPicker.datepicker("getStartDate"),window.resEndPicker.datepicker("getStartDate"),"freeBeds_")},initEdit:function(a,b,c){V3Reservation.periodID=a;let d,e=window.userPeriod,f=new Date,g=new Date;if(g.setDate(g.getDate()+10),g.setHours(0,0,0,0),f.setHours(0,0,0,0),$("#periodID").val(V3Reservation.periodID),b<f&&"0"!==localStorage.getItem("new_res")&&(b=f),V3Reservation.periodEndDate=new Date(e.period_end),window.endDate=new Date(window.settings.setting_calendar_start),"0"===localStorage.getItem("new_res")&&(window.endDate=new Date(window.endDateString[0],window.endDateString[1]-1,window.endDateString[2],0,0,0)),b.setHours(0,0,0,0),window.endDate.setHours(0,0,0,0),$("#hideAll").hide(),$("[id^=\"show_res\"]").show(),V3Reservation.datePickerSettings={format:"dd.mm.yyyy",weekStart:1,todayBtn:"linked",clearBtn:!0,language:"de",calendarWeeks:!0,autoclose:!0,todayHighlight:!0,startDate:V3Reservation.formatDate(b),endDate:V3Reservation.formatDate(window.endDate),defaultViewDate:{year:f.getFullYear(),month:f.getMonth(),day:f.getDate()},beforeShowDay:function(a){return V3Reservation.addBeforeShowDayEdit(a,g,!0,this.startDate)},orientation:"bottom"},$(".input-daterange").datepicker(V3Reservation.datePickerSettings).on("hide",function(a){V3Reservation.onHide(a)}),window.resStartPicker=$(".input-daterange").find("#reservation_started_at"),window.resEndPicker=$(".input-daterange").find("#reservation_ended_at"),c){window.resStartPicker.datepicker("setDate",b);let a={startDate:b,endDate:new Date(b.getTime())};V3Reservation.adaptChanged(a,a.endDate)}if("0"===localStorage.getItem("new_res")){({startDate:b,endDate:new Date(b.getTime())});$.each($("[id^=\"guestDates_\"]"),function(a){d=$("#guestDates_"+a),d.datepicker(V3Reservation.datePickerSettings),window.startGuestPicker[a]=d.find("#reservation_guest_started_at_"+a),window.endGuestPicker[a]=d.find("#reservation_guest_ended_at_"+a),window.startGuestPicker[a].datepicker("setStartDate",window.resStartPicker.datepicker("getDate")),window.startGuestPicker[a].datepicker("setEndDate",window.resEndPicker.datepicker("getDate")),window.endGuestPicker[a].datepicker("setStartDate",window.resStartPicker.datepicker("getDate")),window.endGuestPicker[a].datepicker("setEndDate",window.resEndPicker.datepicker("getDate"))})}else d=$("#guestDates_0"),d.datepicker(V3Reservation.datePickerSettings),window.startGuestPicker[0]=d.find("#reservation_guest_started_at_0"),window.endGuestPicker[0]=d.find("#reservation_guest_ended_at_0");V3Reservation.getFreeBeds(window.resStartPicker.datepicker("getStartDate"),window.resEndPicker.datepicker("getEndDate"),"freeBeds_")},adaptChanged:function(a,b){if(isNaN(a.endDate.getTime())||isNaN(a.startDate.getTime())){window.resEndPicker.datepicker("setDate",null),window.resStartPicker.datepicker("setDate",null);for(let a=0;a<window.startGuestPicker.length;a++)window.startGuestPicker[a].datepicker("setDate",null),window.endGuestPicker[a].datepicker("setDate",null);return V3Reservation.noClick(!0),!1}a.startDate>=a.endDate&&(a.endDate.setDate(a.endDate.getDate()+1),window.resEndPicker.datepicker("setStartDate",a.endDate),window.resEndPicker.datepicker("setEndDate",b),window.resStartPicker.datepicker("setEndDate",b),window.resEndPicker.datepicker("setDate",a.endDate),V3Reservation.noClick(!1));for(let c=0;c<window.startGuestPicker.length;c++){if(a.startDate>window.startGuestPicker[c].datepicker("getDate")&&window.startGuestPicker[c].datepicker("setDate",a.startDate),a.endDate<=window.endGuestPicker[c].datepicker("getDate")&&window.endGuestPicker[c].datepicker("setDate",a.endDate),a.startDate>=window.endGuestPicker[c].datepicker("getDate")){let b=new Date(a.startDate.getTime());b.setDate(a.startDate.getDate()+1),b.setHours(0,0,0,0),window.endGuestPicker[c].datepicker("setDate",b),window.endGuestPicker[c].datepicker("setEndDate",b)}else window.endGuestPicker[c].datepicker("setEndDate",a.endDate);window.startGuestPicker[c].datepicker("setStartDate",a.startDate),window.startGuestPicker[c].datepicker("setEndDate",a.endDate),1===V3Reservation.firstTimeChangeEndDate&&(window.endGuestPicker[c].datepicker("setDate",a.endDate),window.endGuestPicker[c].datepicker("setEndDate",a.endDate)),null===window.startGuestPicker[c].datepicker("getDate")&&window.startGuestPicker[c].datepicker("setDate",window.resStartPicker.datepicker("getDate")),null===window.endGuestPicker[c].datepicker("getDate")&&window.endGuestPicker[c].datepicker("setDate",window.resEndPicker.datepicker("getDate"))}V3Reservation.calcNights(a.startDate,a.endDate,"#reservation_nights_total"),V3Reservation.setReservationHeaderText("#res_header_text",a,$("#reservation_nights_total").text()),V3Reservation.getFreeBeds(a.startDate,a.endDate,"freeBeds_")},getFreeBeds:function(a,b,c){let d=window.reservationsSums;V3Reservation.writeFreeBedsStorage(d,c,a,b),0!==Object.keys(d).length||d.constructor!==Object},writeFreeBedsStorage:function(a,b,c,d){Object.keys(a).length;Object.keys(a).forEach(function(d){let e,f=new RegExp("^"+b),g=window.settings.setting_num_bed;f.test(d)&&(e=d.split("_"),0<window.parseInt(a[d],10)&&(g-=window.parseInt(a[d],10),window.localStorage.setItem(e[1]+"-"+e[2]+"-"+e[3],g),V3Reservation.freeBeds[e[1]+"-"+e[2]+"-"+e[3]]=g))}),V3Reservation.setFreeBeds(c,d)},writeLocalStorage:function(a){let b,c;for(c=0;c<a.length;c++)b=a[c],window.localStorage.hasOwnProperty("period_"+c)||window.localStorage.setItem("period_"+b.id,JSON.stringify(b))},writeNewBeds:function(a){let b=parseInt($("#reservation_guest_num_total").text(),10),c=parseInt(window.localStorage.getItem(a),10);isNaN(c)&&(c=parseInt(window.localStorage.getItem("new_"+a),10)),isNaN(c)&&(c=window.settings.setting_num_bed),window.localStorage.setItem("new_"+a,c-b)},checkResBed:function(a){let b=parseInt(window.localStorage.getItem(a),10)-1;return isNaN(b)&&(b=parseInt(window.localStorage.getItem("new_"+a),10)-1),isNaN(b)&&(b=1),0>b},getNewResBeds:function(){if(0<$("[id^=\"guests_date\"]").length)return!1;for(let a=window.resStartPicker.datepicker("getDate"),b=window.resEndPicker.datepicker("getDate");a<b;){let b=a.getFullYear()+"-"+GlobalFunctions.smallerThenTen(a.getMonth())+"-"+GlobalFunctions.smallerThenTen(a.getDate());if(V3Reservation.checkResBed(b))return V3Reservation.tooMuchBeds(b),!1;a.setDate(a.getDate()+1)}},getNewBeds:function(){let a;$.each($("[id^=\"guests_date\"]"),function(b){let c=window.startGuestPicker[b].datepicker("getDate"),d=window.endGuestPicker[b].datepicker("getDate");a=parseInt($("#reservation_guest_num_"+b).val(),10),V3Reservation.loopDates(c,d,"-",V3Reservation.writeNewBeds,!1,a)})},createTimeLine:function(a){let b,c,d=window.settings.setting_calendar_start.split(" ")[0].split("-"),f=window.parseInt(window.settings.setting_calendar_duration,10),e=new Date,g=new Date(d[0],d[1]-1,d[2],0,0,0,0),h=function(a,b,c){return $.grep(a,function(a){return-1<a[b].indexOf(c)})},j=function(a,b,c,d){let e=h(a,"period_start_new",c,d),f=new Date(d);return 0===e.length&&(f.setMonth(f.getMonth()-1),c=f.getFullYear()+"-"+GlobalFunctions.smallerThenTen(f.getMonth()+1),e=j(a,"period_start_new",c,f)),e},k=[],l=0;for(g.setFullYear(e.getFullYear()+f),g.setMonth(11),b=$("#timeliner"),b.html("");e<=g;)c=e.getFullYear()+"-"+GlobalFunctions.smallerThenTen(e.getMonth()+1),b.append("<li id=\"tl-"+c+"\" class=\"graph-unit-container cal-unit-container\"><div class=\"graph-unit-day cal-unit-day\">"+GlobalFunctions.showDate(e,"short")+"</div></li>"),k=j(a,"period_start_new",c,e),$("#tl-"+c).addClass(k[0].clan_code+"-solid").attr("data_clan",k[0].clan_code).attr("data-period-id",k[0].id).append("<span style=\"text-align: center; display: block\">"+k[0].clan_description+"</span>"),e.setMonth(e.getMonth()+1),l++},calcNights:function(a,b,c){"object"!=typeof a&&(a=new Date(V3Reservation.deFormatDate(a,".",!0))),"object"!=typeof b&&(b=new Date(V3Reservation.deFormatDate(b,".",!0)));let d=parseInt((b-a)/1e3/24/3600,10),e=0>d||isNaN(d)?0:d;$(c).text(e),$("[id^=\"number_nights_\"]").trigger("input"),$("[id^=\"price_\"]").trigger("input")},formatDate:function(a,b,c){if(void 0===a)return!1;if(void 0===c&&(c="."),"string"==typeof a)return a;!a instanceof Date;let d=a.getMonth()+1,e=10>a.getDate()?"0"+a.getDate():a.getDate(),f=10>d?"0"+d:d;return b?a.getDate()+c+" "+window.fullMonthNames[a.getMonth()]+" "+a.getFullYear():e+c+f+c+a.getFullYear()},deFormatDate:function(a,b,c){let d=a.split(b),e=[],f=parseInt(d[1],10),g=parseInt(d[0],10);return e[2]=10>g?"0"+g:g,e[1]=10>f?"0"+f:f,e[0]=d[2],c?e.join(b):e},checkReservationMaxDates:function(a,b,c,d,e){let f,g,h="object"==typeof a?a:new Date(V3Reservation.deFormatDate(a,".",!0)),j="object"==typeof b?b:new Date(V3Reservation.deFormatDate(b,".",!0));$.each($("[id^=\"reservation_guest_started_at_\"]"),function(k,i){f=new Date(V3Reservation.deFormatDate($(i).val(),".",!0)),g=new Date(V3Reservation.deFormatDate($("#reservation_guest_ended_at_"+k).val(),".",!0)),(h>f||e)&&(c[k+1].setSelectedDate(h),c[k+1].setMinimumDate(h),c[k+1].setting.i18n.headerTitle=V3Reservation.langStrings.arrival+": "+V3Reservation.formatDate(h,!0)),(j<g||e)&&(d[k+1].setSelectedDate(j),d[k+1].setMaximumDate(j),d[k+1].setting.i18n.headerTitle=V3Reservation.langStrings.depart+": "+V3Reservation.formatDate(j,!0)),V3Reservation.calcNights(a,b,"#number_nights_"+k)})},setGuestHeaderText:function(a,b,c,d,e){let f="0"==c?"":"&nbsp;x&nbsp;"+window.rolesTrans[c],g=1===parseInt(e,10)?window.reservationStrings.night:window.reservationStrings.nights,h=""==d?"":": "+d,i=""==e?"":" = "+e+" "+g,j=window.guestTitle+V3Reservation.formatDate(b.startDate)+" - "+V3Reservation.formatDate(b.endDate)+i+h+f;$("#guest_title_"+a).html(j),$("#hidden_guest_title_"+a).val(j)},setReservationHeaderText:function(a,b,c){let d=1===parseInt(c,10)?window.reservationStrings.night:window.reservationStrings.nights,e=""==c?"":" = "+c+" "+d,f=V3Reservation.formatDate(b.startDate)+" - "+V3Reservation.formatDate(b.endDate)+e;$("#res_header_text").html(f),$("#reservation_title").val(f)},setFreeBeds:function(a,b){$("[id^=\"free-beds_\"]").html("");V3Reservation.loopDates(a,b,"-",function(a){let b=window.localStorage.getItem(a),c=null===b?window.settings.setting_num_bed:GlobalFunctions.smallerThenTen(window.parseInt(b,10),!0),d=a.split("-"),e=new Date(d[0],d[1],d[2],0,0,0,0),f=d[2]+"."+GlobalFunctions.smallerThenTen(parseInt(d[1],10)+1)+"."+d[0]+": <span style=\"text-align: right\"><strong>"+c+"</strong></span>";$("#all-free-beds-standard").html(""),0<$("#free-beds_"+a).length?$("#free-beds_"+a).html(f):$("#all-free-beds").append("<li id=\"free-beds_"+a+"\">"+f+"</li>"),0>=parseInt(c,10)&&!V3Reservation.disabledDates.find(a=>a.val===V3Reservation.formatDate(e))&&V3Reservation.disabledDates.push({val:e})},!1)},calcGuests:function(){let a,b,c=0,d=$("[name=\"reservation_guest_num[]\"]");for(a=0;a<d.length;a++)b=d[a].value,(void 0===b||""===b)&&(b=0),c+=parseInt(b,10);return $("#reservation_guest_num_total").text(c+1),$("#hidden_reservation_guest_num_total").val(c),V3Reservation.checkOccupiedBeds(c+1),c},calcPrice:function(a){let b,c,d,e,f=$("#reservation_guest_guests_"+a).val();return"0"===f?0:(b=parseInt($("#number_nights_"+a).text(),10),c=parseInt($("#reservation_guest_num_"+a).val(),10),d=isNaN(c)?0:c,e=window.rolesTaxes[f]*b*d,isNaN(e)||($("#price_"+a).text(e+".-"),$("#hidden_reservation_guest_price_"+a).val(e),$("[id^=\"price_\"]").trigger("input")),V3Reservation.calcGuests(),parseFloat(e))},calcAllPrices:function(){let a=0,b=$("[id^=\"hider_\"]");$.each(b,function(b){a+=V3Reservation.calcPrice(b)}),$("#reservation_costs_total").html("<strong>"+a+".-</strong>"),$("#hidden_reservation_costs_total").val(a)},checkOccupiedBeds:function(a){let b=!1,c="0"===window.localStorage.getItem("new_res")?"resId"+$("#id").val():"",d=window.settings.setting_num_bed,e=function(e){let f=parseInt(window.localStorage.getItem(e),10);if(isNaN(f)&&(f=d),""!=c){if(f<a&&!b)return b=!0,V3Reservation.tooMuchBeds(e),!1;}else if(a>f&&!b)return b=!0,V3Reservation.tooMuchBeds(e),!1};b||V3Reservation.loopDates($("#reservation_started_at").val(),$("#reservation_ended_at").val(),"-",e,V3Reservation.tooMuch)},loopDates:function(a,b,c,d,f,g){let h,i,j,k,l;if(f)return!1;for("string"==typeof a?(h=a.split("."),i=new Date(window.parseInt(h[2],10),h[1]-1,window.parseInt(h[0],10),0,0,0,0),j=b.split("."),k=new Date(window.parseInt(j[2],10),j[1]-1,window.parseInt(j[0],10),0,0,0,0)):(i=new Date(a),k=new Date(b));i<k;)l=i.getFullYear()+c+GlobalFunctions.smallerThenTen(i.getMonth())+c+GlobalFunctions.smallerThenTen(i.getDate()),d(l,g),i.setDate(i.getDate()+1)},tooMuchBeds:function(a){let b=$("#free-beds_"+a);$.each($("[id^=\"free-beds_\"]"),function(a,b){$(b).removeClass("tooMuchBeds")}),b.addClass("tooMuchBeds"),$("#all-free-beds-container").show(),$("#free_beds-modal").modal({backdrop:!1,keyboard:!0}),0<b.length&&$("#all-free-beds").scrollTop($("#all-free-beds").scrollTop()+(b.position().top-141)),$("#total_res").addClass("alert-danger").removeClass("alert-info"),$("#save_reservation").attr("disabled",!0),$("#clone_guest").attr("disabled",!0),$("#show-all-free-beds>.hideContent").addClass("showContent")},enoughBeds:function(){$.each($("[id^=\"free-beds_\"]"),function(a,b){$(b).removeClass("tooMuchBeds")}),$("#all-free-beds-container").hide(),$("#free_beds>li>a").removeClass("jquery-hover-a"),$("#total_res").removeClass("alert-danger").addClass("alert-info"),$("#no_free_beds").hide(),$("#save_reservation").attr("disabled",!1),$("#clone_guest").attr("disabled",!1)},checkExistentReservation:function(a,b){let c=a.getFullYear()+"-"+GlobalFunctions.smallerThenTen(a.getMonth()+1)+"-"+GlobalFunctions.smallerThenTen(a.getDate()),d=b.getFullYear()+"-"+GlobalFunctions.smallerThenTen(b.getMonth()+1)+"-"+GlobalFunctions.smallerThenTen(b.getDate());$.ajax({url:"check_existent",method:"POST",data:{start:c,end:d,_token:window.token},success:function(a){GlobalFunctions.unAuthorized(a),isNaN(parseInt(a,10))||($("#edit_reservation_exists").attr("action",window.urlTo+"/edit_reservation/"+a),$("#reservation_exists").modal({backdrop:"static",keyboard:!1}))}})},deleteReservation:function(a){$.ajax({url:"/delete_reservation",method:"POST",data:{res_id:a,_token:window.token},success:function(b){GlobalFunctions.unAuthorized(b);let c=$.parseJSON(b);return c.hasOwnProperty("error")?($("#no_delete_reservation").modal({backdrop:"static",keyboard:!1}),!1):void($("#delete_table_all_reservations_"+a).remove(),$("#delete_table_all_reservations_guests_"+a).remove(),0===$("[id^=\"all_reservations_\"]").length&&$("#noview").find("h1").html(window.reservationStrings.no_bookings))}})},deleteGuestEntry:function(a){let b={};$("#guests_date_"+a).remove(),0===$("[id^=\"guests_date_\"]").length&&($("#addZeroGuest").show(),$("#save_reservation").attr("disabled",!1)),$.each($("[id^=\"guests_date_\"]"),function(a,b){let c=$(b).find("*"),d=$(this).attr("id").split("_");d.pop(),$(this).attr("id",d.join("_")+"_"+a),$.each(c,function(){if($(this).attr("id")!==void 0){let b=$(this).attr("id").split("_");b.pop(),$(this).attr("id",b.join("_")+"_"+a)}})}),window.startGuestPicker.splice(a,1),window.endGuestPicker.splice(a,1),$("[id^=\"reservation_guest_num_\"]:not(#reservation_guest_num_total)").trigger("input");for(let c=0;c<window.startGuestPicker.length;c++)b.startDate=window.startGuestPicker[c].datepicker("getDate"),b.endDate=window.endGuestPicker[c].datepicker("getDate"),V3Reservation.calcNights(b.startDate,b.endDate,"#reservation_nights_total"),V3Reservation.setReservationHeaderText("#res_header_text",b,$("#reservation_nights_total").text()),V3Reservation.checkOccupiedBeds(parseInt($("#reservation_guest_num_total").text(),10)),V3Reservation.calcAllPrices(),V3Reservation.calcGuests();0===window.startGuestPicker.length&&(b.startDate=window.resStartPicker.datepicker("getDate"),b.endDate=window.resEndPicker.datepicker("getDate"),V3Reservation.calcNights(b.startDate,b.endDate,"#reservation_nights_total"),V3Reservation.setReservationHeaderText("#res_header_text",b,$("#reservation_nights_total").text()),V3Reservation.calcAllPrices(),V3Reservation.calcGuests()),$("[id^=\"clone_guest\"]").attr("disabled",!1),$("[id^=\"delete_reservation_\"]").attr("disabled",!0),$("#total_res").removeClass("alert-danger").addClass("alert-info")}};