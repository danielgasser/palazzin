var chart,dataTableOptions={dom:"Bfrtip",buttons:[{extend:"copy",text:"Kopieren",className:"btn btn-default"},{extend:"csv",text:"CSV",className:"btn btn-default"},{extend:"excel",text:"Excel",className:"btn btn-default"},{extend:"pdf",text:"PDF",className:"btn btn-default"},{extend:"print",text:"Drucken",className:"btn btn-default"}],searching:!1,pageLength:12,paging:!1,sortable:!1,ordering:!1,language:{paginate:{first:window.paginationLang.first,previous:window.paginationLang.previous,next:window.paginationLang.next,last:window.paginationLang.last},info:window.paginationLang.info,sLengthMenu:window.paginationLang.length_menu},responsive:!0,autoWidth:!1,fixedHeader:{header:!1,footer:!1},columns:[{width:"76px"},null,null,null,null,null,null,null,null,null,null,null,null,null]},dataTableOptionsTotals={columnDefs:[{targets:[0],visible:!0,orderable:!0,data:"bill_no"},{targets:[1],visible:!0,orderable:!0,render:function(a,b){if("sort"===b){let b=a.split("."),c=new Date(b[2],b[1],b[0],0,0,0);return c.getTime()}return a}},{targets:[2],visible:!0,orderable:!0,render:function(a,b){if("sort"===b){let b=a.split("."),c=new Date(b[2],b[1],b[0],0,0,0);return c.getTime()}return a}},{targets:[3],visible:!0,orderable:!0,render:function(a,b){if("sort"===b){let b=a.split("."),c=new Date(b[2],b[1],b[0],0,0,0);return c.getTime()}return a}},{targets:[4],visible:!0,orderable:!0,type:"numeric-comma",render:function(a,b){return"sort"===b?(console.log(parseFloat(a.split(" ")[1])),parseFloat(a.split(" ")[1])):a}}],dom:"Bfrtip",buttons:[{extend:"copy",text:"Kopieren",className:"btn btn-default"},{extend:"csv",text:"CSV",className:"btn btn-default"},{extend:"excel",text:"Excel",className:"btn btn-default"},{extend:"pdf",text:"PDF",className:"btn btn-default"},{extend:"print",text:"Drucken",className:"btn btn-default"}],searching:!0,paging:!1,sortable:!0,ordering:!0,language:{emptyTable:"Keine Daten vorhanden",paginate:{first:window.paginationLang.first,previous:window.paginationLang.previous,next:window.paginationLang.next,last:window.paginationLang.last},search:window.langDialog.search,info:window.paginationLang.info,sLengthMenu:window.paginationLang.length_menu},responsive:!0,autoWidth:!0,fixedHeader:{header:!1,footer:!1}},graphSeries=[],fillMonthTable=function(a,b){'use strict';var c=$("#monthTable");c.html(""),$.each(b,function(a,d){let e=window.parseInt(d,10);c.append("<div style=\"font-weight: bold; text-align: center; border-top: 4px solid #18130c;\"><h4>"+e+"</h4></div>"),c.append("<table id=\"datatable_"+e+"\" class=\"table table-stats\"></table>"),a<b.length-1&&c.append("<pagebreak />"),$("#datatable_"+e).append("<thead><tr><th><h6>Zur Rechnung (PDF)</h6></th><th><h6>Rechnungsdatum</h6></th><th><h6>Reservationsdatum</h6></th><th><h6>Bezahlt am</h6></th><th><h6>Rechnungsbetrag</h6></th></tr></thead>").append("<tbody id=\"sep_year_"+e+"\">")}),$.each(a,function(a,b){var c=null===b.bill_paid?"-":b.bill_paid_show;$("#sep_year_"+b.bill_bill_year).append("<tr><td><a target=\"_blank\" href=\""+b.bill_path+"\">"+b.bill_no+"</a></td><td>"+b.bill_bill_date_show+"</td><td>"+b.reservation_started_at_show+"</td><td>"+c+"</td><td>"+b.bill_currency+" "+b.bill_total+"</td></tr>")}),$.each(b,function(a,b){let c=window.parseInt(b,10),d="#datatable_"+c;$.fn.DataTable.isDataTable(d)&&$(d).destroy(),$(d).DataTable(dataTableOptionsTotals)})},fillTotalTotalTable=function(a,b){'use strict';var c,d,e,f,g,h,i=0,j=0,k=0,l="<table id=\"datatable-total\" class=\"table table-stats\">",m=[],n=$("#total-total-tables"),o=a.totals;0===a.length?$("#datatable").hide():$("#datatable").show(),$.each(b,function(a,b){m.push(window.parseInt(b))}),n.html(""),l+="<thead>",l+="<tr>",l+="<th colspan=\"3\" id=\"total_total_label\"><h6>Total alle Jahre "+m.join(", ")+"</h6></th>",l+="</tr>",l+="<tr>",l+="<th style=\"width: 33%\"><h6>Total</h6></th>",l+="<th style=\"width: 33%\"><h6>Bezahlt</h6></th>",l+="<th style=\"width: 33%\"><h6>Unbezahlt</h6></th>",l+="</tr>",l+="</thead>",l+="<tbody id=\"data-short\">",l+="<tr>",l+="<td class=\"paid\" id=\"total_total\"></td>",l+="<td class=\"total\" id=\"total_paid\"></td>",l+="<td class=\"unpaid\" id=\"total_unpaid\"></td>",l+="</tr>",l+="</tbody>",l+="</table><pagebreak />",n.append(l).append("<div id=\"chart_total_total\"></div>"),o===void 0?($("#chart_total_total").html("<b>Keine Daten</b>"),$("#datatable-total").hide()):(c=o.total===void 0?0:o.total,d=o.paid===void 0?0:o.paid,e=o.unpaid===void 0?0:o.unpaid,f=o.total===void 0?"0.00":o.total_show,g=o.paid===void 0?"0.00":o.paid_show,h=o.unpaid===void 0?"0.00":o.unpaid_show,$("#total_total").html(f),$("#total_paid").html(g),$("#total_unpaid").html(h),i=window.parseFloat(c),j=window.parseInt(c)/window.parseInt(e),k=window.parseInt(c)/window.parseInt(d),$(function(){$("#chart_total_total").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie"},title:{text:"Total alle Jahre "+m.join(", ")},tooltip:{headerFormat:" ",pointFormat:"{point.name}: <b>{point.percentage:.1f} %</b>"},plotOptions:{pie:{allowPointSelect:!1,cursor:"pointer",dataLabels:{enabled:!0,format:"{point.name}: {point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black",fontSize:"16px"}}}},series:[{name:"Total Jahre "+m.join(", "),colorByPoint:!0,data:[{name:"Bezahlt "+m.join(", "),y:j,color:"#333",fontSize:"18px"},{name:"Unbezahlt "+m.join(", "),y:k,color:"#ff9900",fontSize:"18px"}]}]});graphSeries=0,i=0,j=0,k=0}))},fillYearTotalTable=function(a,b){'use strict';var c,d=0,e=0,f=0,g=[];$.each(b,function(a,b){g.push(window.parseInt(b))}),$("#all-year-tables").html(""),$.each(b,function(b,g){var h,i,j,k,l,m,n=window.parseInt(g,10),o="<table autosize=\"1\" id=\"datatable-year-"+n+"\" class=\"table table-stats\">";o+="<thead>",o+="<tr>",o+="<th colspan=\"3\" id=\"total_year_label_"+n+"\"><h6>Total Jahr "+n+"</h6></th>",o+="</tr>",o+="<tr>",o+="<th style=\"width: 33%\"><h6>Total</h6></th>",o+="<th style=\"width: 33%\"><h6>Bezahlt</h6></th>",o+="<th style=\"width: 33%\"><h6>Unbezahlt</h6></th>",o+="</tr>",o+="</thead>",o+="<tbody id=\"data-short\">",o+="<tr>",o+="<td class=\"total\" id=\"year_total_"+n+"\"></td>",o+="<td class=\"paid\" id=\"year_paid_"+n+"\"></td>",o+="<td class=\"unpaid\" id=\"year_unpaid_"+n+"\"></td>",o+="</tr>",o+="<tr><td colspan=\"3\" style=\"width: 547px\"><div id=\"chart_year_total_"+n+"\"></div></td>",o+="</tr>",o+="</tbody>",o+="</table><pagebreak />",$("#all-year-tables").append(o),h=a[n]===void 0?0:a[n].total,i=a[n]===void 0?0:a[n].paid,j=a[n]===void 0?0:a[n].unpaid,k=a[n]===void 0?"0.00":a[n].total_show,l=a[n]===void 0?"0.00":a[n].paid_show,m=a[n]===void 0?"0.00":a[n].unpaid_show,$("#year_paid_"+n).html(l),$("#year_total_"+n).html(k),$("#year_unpaid_"+n).html(m),d=window.parseFloat(h),e=100/d*window.parseFloat(i),f=100/d*window.parseFloat(j),0<d?$(function(){$("#chart_year_total_"+n).highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie"},title:{text:"Total Jahr "+n},tooltip:{headerFormat:" ",pointFormat:"{point.name}: <b>{point.percentage:.1f} %</b>"},plotOptions:{pie:{allowPointSelect:!1,cursor:"pointer",dataLabels:{enabled:!0,format:"{point.name}: {point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black",fontSize:"18px",fontWeight:"bold"}}}},series:[{name:n,colorByPoint:!0,data:[{name:"Bezahlt "+n,y:e,color:"#333"},{name:"Unbezahlt "+n,y:f,color:"#ff9900"}]}]}),c=0,d=0,e=0,f=0}):($("#chart_year_total_"+n).html("<b>Keine Daten f\xFCrs Jahr "+n+"</b>"),$("#datatable-year-"+n).hide())}),fillTotalTotalTable(a,b)},fillTable=function(a,b){'use strict';var c=$("#datatable-short"),d=[],e=[],f=[],g=[],h=[],i=a.total===void 0?[]:a.total,j=a.paid===void 0?[]:a.paid,k=a.unpaid===void 0?[]:a.unpaid;c.html(""),$.each(b,function(a,b){h.push(window.parseInt(b))}),$("#data-total-short").html(""),$("#charts").html(""),$.each(b,function(a,b){var h,l,m,n,o,p,q,r,s="",t="",u="",v="",w=0,x=0,y=0,z=window.parseInt(b);for(c.append("<div id=\"charts_"+z+"\"></div>"),c.append("<table id=\"datatable-short_"+z+"\" class=\"table table-stats\"></table><pagebreak />"),h=$("#datatable-short_"+z),h.append("<thead><tr id=\"month_"+z+"\"><th>&nbsp;</th>"),h.append("<tbody id=\"data-total-short_"+z+"\"></tbody>"),s+="",t+="<tr id=\"total_"+z+"\"><td class=\"total\">Total</td>",u+="<tr id=\"paid_"+z+"\"><td class=\"paid\">Bezahlt</td>",v+="<tr id=\"unpaid_"+z+"\"><td class=\"unpaid\">Unbezahlt</td>",l=1;13>l;l+=1)m=z+"_"+GlobalFunctions.smallerThenTen(l),p=void 0===i[m]?"0.00":i[m],q=void 0===j[m]?"0.00":j[m],r=void 0===k[m]?"0.00":k[m],s+="<th>"+window.langCalendar[l]+"</th>",t+="<td class=\"total\" id=\"total_month_short_"+m+"\">"+p+"</td>",u+="<td class=\"paid\" id=\"paid_month_short_"+m+"\">"+q+"</td>",v+="<td class=\"unpaid\" id=\"unpaid_month_short_"+m+"\">"+r+"</td>",o=void 0===i[m]?0:i[m].replace("'",""),n=isNaN(window.parseInt(o))?0:window.parseInt(o),d.push(n),o=void 0===j[m]?0:j[m].replace("'",""),n=isNaN(window.parseInt(o))?0:window.parseInt(o),e.push(n),o=void 0===k[m]?0:k[m].replace("'",""),n=isNaN(window.parseInt(o))?0:window.parseInt(o),g.push(n);$.each(d,function(a,b){w+=parseFloat(b)}),$.each(e,function(a,b){x+=parseFloat(b)}),$.each(g,function(a,b){y+=parseFloat(b)}),s+="<th>Total</th></tr></thead>",t+="<td class=\"total\">"+w.toLocaleString("de-CH",{minimumFractionDigits:2})+"</td></tr>",u+="<td class=\"paid\">"+x.toLocaleString("de-CH",{minimumFractionDigits:2})+"</td></tr>",v+="<td class=\"unpaid\">"+y.toLocaleString("de-CH",{minimumFractionDigits:2})+"</td></tr>",w=0,x=0,y=0,$("#month_"+z).append(s),$("#data-total-short_"+z).append(t),$("#data-total-short_"+z).append(u),$("#data-total-short_"+z).append(v),f.push({name:"Bezahlt",data:e,color:"#333"}),f.push({name:"Unbezahlt",data:g,color:"#ff9900"}),$("#charts_"+z).append("<div id=\"chart_div_"+z+"\"></div>"),0<g.reduce(function(a,b){return a+b},0)||0<e.reduce(function(a,b){return a+b},0)?$(function(){$("#chart_div_"+z).highcharts({chart:{type:"column",height:400},title:{style:{fontSize:"18px",fontWeight:"bold"},text:"Rechnungen "+z},xAxis:{categories:Object.values(window.langCalendar),labels:{style:{fontSize:"18px"}}},yAxis:{min:0,title:{text:"CHF",labels:{style:{fontSize:"18px"}}},stackLabels:{enabled:!0,style:{fontWeight:"bold",fontSize:"18px",color:Highcharts.theme&&Highcharts.theme.textColor||$(".total").css("color")},formatter:function(){if(0<this.total)return this.total}}},legend:{align:"right",x:-30,verticalAlign:"top",y:25,floating:!0,backgroundColor:Highcharts.theme&&Highcharts.theme.background2||"white",borderColor:"#CCC",borderWidth:1,shadow:!1},tooltip:{headerFormat:"<b>{point.x}</b><br/>",pointFormat:"{series.name}: {point.y}<br/>Total: {point.stackTotal}"},plotOptions:{column:{stacking:"normal",dataLabels:{enabled:!0,color:Highcharts.theme&&Highcharts.theme.dataLabelsColor||"white",style:{textShadow:"0 0 3px black",fontWeight:"bold",fontSize:"18px"}}},series:{dataLabels:{enabled:!0,formatter:function(){if(0<this.y)return this.y}}}},series:f}),f=[]}):($("#chart_div_"+z).html("Keine Daten f\xFCrs Jahr "+z),$("#month_"+z).hide(),$("#total_"+z).hide(),$("#paid_"+z).hide(),$("#unpaid_"+z).hide()),d=[],e=[],g=[],$.fn.DataTable.isDataTable(h)&&$(h).destroy(),$(h).DataTable(dataTableOptions)}),window.getStatsData("/stats_bill_total",b,fillYearTotalTable),window.getStatsData("/stats_bill",b,fillMonthTable),window.checkedYear=[]};$(document).ready(function(){'use strict';$("[name^=\"year\"]").on("change",function(){window.checkedYear=[],window.showYear=[],$.each($("[name^=\"year\"]"),function(a,b){$(b).is(":checked")&&(window.checkedYear.push(b.value+"-%"),window.showYear.push(b.value)),window.yearColors[b.value]=window.yearColorsSet[a]}),window.checkedYear.sort(),window.showYear.sort()}),$(document).on("click","#getYears",function(){0===window.checkedYear.length&&$("[name^=\"year\"]").trigger("change"),window.getStatsData("/stats_bill_total_year",window.checkedYear,window.fillTable)})});