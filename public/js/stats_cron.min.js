var distinctArray=function(a){for(var b=[],c=0,d=a.length;c<d;c++)-1==b.indexOf(a[c])&&b.push(a[c]);return b},fillTable=function(a,b,c,d){'use strict';var e,f,g="",h=[],j=c===void 0?null:c,k=d===void 0?null:d,l=null,m=null,n=null,o={},p=null,q="",r=$("#datatable"),s=[],t=window.route.substr(window.route.lastIndexOf("/")+1),u=window.route.replace(t,"");for(r.html(""),$.ajax({type:"GET",url:u+"stats_chron_guest_night_total",data:{year:b},success:function(a){l=a.total_family[1],m=a.total_family[0],n=a.total_family[2],s=a.guest_props,p=a.total_guests,o=a.total_year_guests,fillFamilyCakeStats(m,h,"chart_div_three",l,"\xDCbernachtungen pro Halbstamm ","pie_nights_",n),null!==m&&fillBarStats(j,k,h,"chart_div"),null!==p&&fillBarStats(k,k,h,"chart_div_two",s),fillFamilyCakeStats(p,h,"chart_div_four",o,"\xDCbernachtungen pro Art des Gastes ","pie_guest_nights_",s)}}),q="<thead><tr><th><h6>Monat</h6></th><th><h6>Name/Vorname</h6></th><th><h6>Stamm</h6></th><th><h6>Halb-Stamm</h6></th><th><h6>Ankunft</h6></th><th><h6>Abreise</h6></th><th><h6>N\xE4chte</h6></th><th><h6>Rechnungs<br>betrag</h6></th><th><h6>G\xE4ste</h6></th></tr></thead>",e=0;e<b.length;e+=1)(f=window.parseInt(b[e],10),void 0!==c[f])&&(r.append("<div style=\"font-weight: bold; text-align: center; border-top: 1px solid #18130c;\"><h4>"+f+"</h4></div><table id=\"dataTable_"+f+"\" style=\"width: 100%\">"+q+"<tbody id=\"cron_year_"+f+"\"></tbody></table>"),h.push(f));$.each(a,function(a,b){g="",g+="<tr>",g+="<td style=\"vertical-align: top\">",g+=window.langCalendar[b.reservation_started_at_month]+" "+b.reservation_started_at_year,g+="</td>",g+="<td style=\"vertical-align: top\">",g+=b.user_first_name+" "+b.user_name,g+="</td>",g+="<td style=\"vertical-align: top\">",g+=b.clan_description,g+="</td>",g+="<td style=\"vertical-align: top\">",g+=b.family_description,g+="</td>",g+="<td style=\"vertical-align: top\">",g+=b.reservation_started_at_show,g+="</td>",g+="<td style=\"vertical-align: top\">",g+=b.reservation_ended_at_show,g+="</td>",g+="<td style=\"vertical-align: top\">",g+=b.reservation_nights,g+="</td>",g+="<td style=\"vertical-align: top\">",b.bill!==void 0&&0<b.bill.length?$.each(b.bill,function(a,b){g+=b.bill_total}):g+=0,g+="</td>",g+="<td style=\"vertical-align: top\"><div class=\"guests\">",b.guest!==void 0&&0<b.guest.length?($.each(b.guest,function(a,c){var d=a===b.guest.length-1?"":"<br>";g+=c.guest_number+" x "+c.role_description+d}),g+="<hr>"+b.guest_sum+" G\xE4ste Total"):g+="Keine G\xE4ste",g+="</div></td>",g+="</tr>",$("#cron_year_"+b.reservation_started_at_year).append(g)})},fillFamilyCakeStats=function(a,b,c,d,e,f,g){var h;$("#"+c).html(""),$.each(b,function(b,j){return void 0===g&&a instanceof Array&&(g=Object.getOwnPropertyNames(a[j])),void 0!==a[j]&&void($("#"+c).append("<div id=\""+f+j+"\" style=\"min-width: 310px; height: 400px; margin: 20px auto;\"></div>"),h={chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie",renderTo:f+j},title:{text:e+j},subtitle:{text:"Total \xDCbernachtungen "+j+": "+d[j],style:{fontSize:"18px"}},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{allowPointSelect:!1,cursor:"pointer",dataLabels:{enabled:!0,style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black",fontSize:"18px",lineHeight:"20px"},formatter:function(){var a=Math.round;return"<h6>"+this.point.name+": "+a(10*this.point.percentage)/10+"% = "+this.y+" N\xE4chte</h6>"}}}},series:[{name:"Anteil",colorByPoint:!0,data:[]}]},void 0!==g&&$.each(g,function(b,c){var d=isNaN(parseInt(a[j][c],10))?0:parseInt(a[j][c],10);h.series[0].data.push({name:c,y:parseInt(d,10),color:$(".total").css("color"),fontSize:"18px"})}),$(function(){new window.Highcharts.Chart(h);h={}}))})},fillBarStats=function(a,b,c,d,e){var f,g,h=[];f="chart_div"===d?"Reservierungen pro Halbstamm ":"Reservierungen pro Art des Gastes ",g={chart:{type:"bar",renderTo:d},title:{text:f},xAxis:{categories:"",title:{text:null}},yAxis:{min:0,tickInterval:1,title:{text:"Anzahl Reservierungen",align:"high"},labels:{overflow:"justify"}},plotOptions:{column:{colorByPoint:!0,colors:window.guestColors[0]},bar:{dataLabels:{enabled:!0}}},legend:{layout:"vertical",align:"right",verticalAlign:"top",x:-40,y:80,floating:!0,borderWidth:1,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF",shadow:!0},series:[]},$.each(c,function(b,c){var d=[];return void 0!==a[c]&&void(e===void 0&&(e=Object.getOwnPropertyNames(a[c])),h.push(c),$.each(e,function(b,e){a[c]!==void 0||a[c][e]!==void 0?d.push(isNaN(parseInt(a[c][e],10))?0:parseInt(a[c][e],10)):d.push(0)}),g.xAxis.categories=e,g.series.push({name:c,data:d,color:window.guestColors[b],fontSize:"18px"}),g.title.text=f+h.join(", "))}),$(function(){new window.Highcharts.Chart(g);g={}})},y=$("#year");$(document).ready(function(){'use strict';$("[name^=\"year\"]").on("change",function(){window.checkedYear=[],$.each($("[name^=\"year\"]"),function(a,b){$(b).is(":checked")&&window.checkedYear.push(b.value+"-%")}),window.checkedYear.sort(),window.showYear.sort()})}),$(document).on("click","#getYears",function(){0===window.checkedYear.length&&$("[name^=\"year\"]").trigger("change"),window.getStatsData("/stats_chron",window.checkedYear,fillTable)});