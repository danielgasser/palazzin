let userTable,urlTop=-1<window.route.indexOf("admin")?"/admin/users/search":"/userlist_search",dataTableSettings={dataSrc:"",responsive:!0,autoWidth:!1,fixedHeader:{header:!0,footer:!0},order:[1,"asc"],columnDefs:[{targets:[0],responsivePriority:1,class:"details",visible:!0,orderable:!1,data:null,defaultContent:""},{targets:[1],responsivePriority:1,visible:!1,orderable:!1,sortable:!1,className:"user_id",data:"user_id"},{targets:[2],responsivePriority:2,data:"user_first_name"},{targets:[3],responsivePriority:4,data:"user_name"},{targets:[4],responsivePriority:5,data:"user_login_name",render:function(a,b,c){return window.isManager?"<a href=\""+urlTo+"/admin/users/edit/"+c.user_id+"\">"+a+"</a>":"<a href=\""+urlTo+"/user/profile/"+c.user_id+"\">"+a+"</a>"}},{targets:[5],responsivePriority:6,data:"email",render:function(a,b,c){let d="<ul style=\"list-style-type: none; margin: 0; padding: 0;\">";return d+="<li class=\"mail_one\"><a href=\"mailto:"+a+"\">"+a+"</a></li>",void 0===c.user_email2||null===c.user_email2?d+="</ul>":0<c.user_email2.length&&(d+="<li><a href=\"mailto:"+c.user_email2+"\">"+c.user_email2+"</a></li>"),d}},{targets:[6],responsivePriority:3,data:"user_fon1",render:function(a,b,c){let d=a.replace(/^0+/,"");return d=d.replace(/ /g,""),d=d.replace("+41",""),"<a href=\"tel:+"+c.user_country_code+d+"\">"+a+"</a>"}},{targets:[7],responsivePriority:24,data:"user_www_label",render:function(a,b,c){return void 0===c.user_www||null===c.user_www?"":0<c.user_www.length?"<a href=\"https://"+c.user_www+"\">"+a+"</a>":""}},{targets:[8],responsivePriority:8,data:"user_address"},{targets:[9],responsivePriority:8,data:"user_zip"},{targets:[10],responsivePriority:8,data:"user_city"},{targets:[11],responsivePriority:8,data:"user_country_code",render:function(a,b,c){return void 0===c.country?"-":c.country.country}},{targets:[12],responsivePriority:24,data:"user_birthday"},{targets:[13],responsivePriority:24,data:"clans",render:function(a){return""===a||null==a?"":a.clan_description}},{targets:[14],responsivePriority:24,data:"families",render:function(a){return""===a||null==a?"":a.family_description}},{targets:[15],responsivePriority:24,data:"roles",render:function(a){let b="<ul>";return $.each(a,function(a,c){b+="<li>"+c.role_description+"</li>"}),b+="</ul>",b}},{targets:[16],responsivePriority:25,data:"last_login",visible:!1}],searching:!1,language:{paginate:{first:window.paginationLang.first,previous:window.paginationLang.previous,next:window.paginationLang.next,last:window.paginationLang.last},info:window.paginationLang.info,sLengthMenu:window.paginationLang.length_menu},fnDrawCallback:function(){},lengthChange:!1},searchSortPaginate=function(a,b,c,d){"use strict";b={search_user:$("#search_user").val(),clan_search:$("#clan_search").val(),family_search:$("#family_search").val(),role_search:$("#role_search").val()},$.ajax({type:"POST",url:a,data:{search_field:b.search_user,sort_field:c,order_by:d,family:b.family_search,clan:b.clan_search,role:b.role_search,user_id:$("#user_id").val()},success:function(a){GlobalFunctions.unAuthorized(a);let b=$.parseJSON(a);userTable.clear(),userTable.rows.add(b),userTable.draw();let c=[];$.each(b,function(a,b){""!==b.user_id&&c.push(b.user_id)}),$("#uIDs").val(c.join(","))}})};$(document).ready(function(){"use strict";userTable=$("#users").DataTable(dataTableSettings),$("#print_name_pdf").val(""),$("#print_table_name_message").html("");let a=new Date,b=$("#year"),c=$("#month");window.yl=GlobalFunctions.createYearList(),window.ml=GlobalFunctions.createMonthList(),GlobalFunctions.fillSelect(c,window.ml,!1),GlobalFunctions.fillSelect(b,window.yl,!0),b.val(a.getFullYear()),c.val(a.getMonth()),$("#newsMessage").hide(),userTable.clear(),userTable.rows.add(window.allUsers),userTable.draw();let d=[];$.each(window.allUsers,function(a,b){""!==b.user_id&&d.push(b.user_id)}),$("#uIDs").val(d.join(","))}),$("#users tbody").on("click","td.00",function(){let a=$(this).closest("tr"),b=userTable.row(a);if(b.child.isShown())b.child.hide(),a.removeClass("shown");else{let c=b.data();b.child(c).show(),a.addClass("shown")}});let timer,chk_me=function(a){clearTimeout(timer),timer=setTimeout(function(){searchIt(a)},500)},search={search_user:$("#search_user").val(),clan_search:$("#clan_search").val(),family_search:$("#family_search").val(),role_search:$("#role_search").val()},searchIt=function(a){let b,c,d;return $.each(search,function(a,b){null==b&&(search[a]="")}),!(3>search.search_user.length&&0===search.clan_search.length&&0===search.family_search.length&&0===search.role_search.length)&&void(a.target.hasOwnProperty("config")?(b=a.target.config.sortList[0],c=$(window.cols[b[0]]).attr("id"),d=1===b[1]?"ASC":"DESC"):(c="user_name",d="ASC"),searchSortPaginate(urlTop,search,c,d))};$(document).on("change","#clan_search",function(a){"use strict";let b=window.families,c=[];$.each(b,function(a,b){""!==a&&c.push({val:a,text:b})}),$("#family_search").find("option").remove().end(),$.each(c,function(a,b){b.val.split("|")[1]===$("#clan_search").val()&&$("#family_search").append("<option value=\""+b.val+"\">"+b.text+"</option>").val("")}),chk_me(a)}),$(document).on("keyup","#search_user",function(a){"use strict";return!(3>this.value.length)&&void chk_me(a)}),$(document).on("change","#family_search, #role_search",function(a){"use strict";a.preventDefault(),chk_me(a)}),$(document).on("submit","form:not(#sendToPrint)",function(a){"use strict";return a.preventDefault(),!1}),$(document).on("click","#goSearch",function(a){a.preventDefault(),chk_me(a)}),$(document).on("click","#printChoice",function(a){a.preventDefault(),$("#print_table_name").modal()}),$(document).on("click","#dload",function(a){a.preventDefault(),$("#print_table_name").modal("hide"),window.open($(this).attr("href"),"_blank")}),$(document).on("click","#sendToPrintSubmit",function(a){a.preventDefault();let b={userIds:$("#uIDs").val(),search_user:$("#search_user").val(),clan_search:$("#clan_search").val(),family_search:$("#family_search").val(),role_search:$("#role_search").val(),sort_field:$("#sort_field").val(),order_by:$("#order_by").val(),print_name_pdf:$("#print_name_pdf").val()};$("#sendToPrintSubmit").attr("disabled",!0),$.ajax({url:window.userListPrintUrl,method:"POST",data:b,success:function(a){$("#sendToPrintSubmit").attr("disabled",!1);let b=JSON.parse(a),c=$("#print_table_name_message");if(b.hasOwnProperty("success"))return $("#print_table_name_text").html(""),c.removeClass("alert-success").removeClass("alert-danger").html("Download: <a id=\"dload\" target=\"_blank\" href=\""+b.success+"\">"+b.pdf_name+"</a>"),!1}})});