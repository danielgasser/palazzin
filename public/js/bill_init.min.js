var billTable,dataTableSettings={dataSrc:"",stripeClasses:["odd","even"],responsive:!1,autoWidth:!0,fixedHeader:{header:!0,footer:!0},language:{paginate:{first:window.paginationLang.first,previous:window.paginationLang.previous,next:window.paginationLang.next,last:window.paginationLang.last},search:window.langDialog.search,info:window.paginationLang.info,sLengthMenu:window.paginationLang.length_menu},order:[1,"asc"],paging:!1,columnDefs:[{orderable:!1,targets:4},{targets:[0],responsivePriority:1,class:"details",visible:!0,orderable:!1,data:null,defaultContent:""},{targets:[1],responsivePriority:1,data:"bill_no"},{targets:[2],responsivePriority:2,visible:!0,orderable:!0,data:"bill_bill_date",render:function(a,b){if("sort"===b){let b=a.split("."),c=new Date(b[2],b[1],b[0],0,0,0);return c.getTime()}return a}},{targets:[3],responsivePriority:2,visible:!0,orderable:!0,data:"bill_total",type:"numeric-comma",render:function(a,b){if("sort"===b){let b=a.split(" ");return parseFloat(b[1])}return a}},{targets:[4],responsivePriority:3,visible:!0,orderable:!0,data:"user_id"},{targets:[5],responsivePriority:4,visible:!0,orderable:!0,data:"bill_due"},{targets:[6],responsivePriority:5,orderable:!1,data:"bill_paid"},{targets:[7],responsivePriority:6,visible:!0,orderable:!0,data:"bill_path"}],initComplete:function(){this.api().columns(5).every(function(){var a=this,b=$("<select class=\"form-control input-sm show_reservation\"><option value=\"\"></option></select>").appendTo($(a.header()).empty()).on("change",function(){var b=$.fn.dataTable.util.escapeRegex($(this).val());a.search(b?"^"+b+"$":"",!0,!1).draw(),datePickerInit()});a.data().unique().sort().each(function(a){b.append("<option value=\""+a+"\">"+a+"</option>")})})}},datePickerSettings={format:"dd.mm.yyyy",weekStart:1,todayBtn:"linked",clearBtn:!0,language:"de",calendarWeeks:!0,autoclose:!0,todayHighlight:!0,immediateUpdates:!0},datePickers=[],datePickerInit=function(){$.each($("[id^=\"paidAt_\"]"),function(a,b){let c=$(b).attr("id");datePickers.push({[c]:$(b).datepicker(datePickerSettings)}),$(b).datepicker("setDate",new Date($(b).parent("td").attr("data-sort"))).on("hide",function(a){payBill(a,$(b).val())})})},deFormatDate=function(a,b){let c=a.split(b),d=[],e=parseInt(c[1],10),f=parseInt(c[0],10);return d[2]=10>f?"0"+f:f,d[1]=10>e?"0"+e:e,d[0]=c[2],d.join("-")},payBill=function(a,b){var c,d,e=a.target.id.split("_")[1];""===b?(c="unpaid",d=window.billPaid[0]):(c="paid",b=deFormatDate(b,"."),d=window.billPaid[1]),a.preventDefault(),$.ajax({type:"GET",url:"/admin/bills/"+c,data:{id:e,bill_paid:b},success:function(a){GlobalFunctions.unAuthorized(a);let b=$("#paidAt_"+e);$("#paid_"+e).html(d),b.val(a.paid)}})};$(document).ready(function(){billTable=$("#bills").DataTable(dataTableSettings),datePickerInit()}),$(document).on("click",".paginate_button>a",function(){datePickerInit()});